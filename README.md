# Redis-ansible
## Общие сведения
Автоматическая развертка инфраструктуры для приложения Redis - Key-value

Только на кластер из 3х машин, состоящих из дистрибутивов: AlterOS, RedOS, Astra

Решение предлагает:
+ Развертывание базы данных Redi - Key-value на машине под управлением Astra
+ Развертывание сервера nginx с базовым шаблоном сайта на машине под управлением Astra
+ Единственный вход в сеть через маршрутизатор под управлением AlterOS
+ Единственный доступ к серверу nginx с машины под управлением RedOS
+ 
Написано по казуальному через bash и ansible
## Скрипты базовой настройки машин
setup-alt.sh - скрипт настройки машины под управлением AlterOS. 

## Скрипт настройки ssh

## Ansible плейбук и files

## Порядок настройки
Независимо от того, использовали ли вы скрипты или вручную провели базовую настройку, пункт "Дальнейшая настройка" нужно выполнять в обоих случаях
### Ручная базовая настройка машин
В проекте представлены скрипты для базовой настройки машин, если по каким-либо причинам они вас не удовлетворяют, вы можете вручную настроить машины. В таком случае для дальнейшей работы необходимо иметь:
1. Настроенную ip адресацию всех хостах, а также resolv интернет имен
2. Установленный и настроенный SSH на всех хостах (открытый 22 порт, разрешение логина через root)
3. Как минимум один из хостов должен иметь доступ в интернет, через которую другие машины также смогуть выходить в него
4. Установленный пароль для пользователя root на Astra и других машинах
5. Установленный ansible на машину под управлением AlterOS
### Автоматизированная базовая настройка машин
**Важно:** перед запуском скрипта на Astra, необходимо сначала сделать базовую настройку машины, под управлением AlterOS, так как скрипт первой, требует установки SSH и обновлению компонентов системы.
#### Настройка AlterOS
1. Перенесите скрипт setup-alt.sh на машину под управлением AlterOS
2. В корневой директории введите следующую команду, чтобы сделать скрипт исполняемым:
```
chmod +x ./setup-alt.sh
```
3. Запустите скрипт, находясь в той же директории:
```
./setup-alt.sh
```
Убедитесь, что вы настроили AlterOS **перед** настройкой Astra

#### Настройка RedOS
1. Перенесите скрипт setup-redos.sh на машину под управлением RedOS
2. В корневой директории введите следующую команду, чтобы сделать скрипт исполняемым:
```
chmod +x ./setup-redos.sh
```
3. Запустите скрипт, находясь в той же директории:
```
./setup-redos.sh
```
В отличие от остальных машин не требует доступа в интернет

#### Настройка Astra
1. Перенесите скрипт setup-astra.sh на машину под управлением Astra
2. В корневой директории введите следующую команду, чтобы сделать скрипт исполняемым:
```
chmod +x ./setup-astra.sh
```
3. Запустите скрипт, находясь в той же директории:
```
./setup-astra.sh
```
Убедитесь, что до запуска скрипта вы настроили AlterOS и что он дает доступ в интернет другим машинам

## После базовой настройки
Скопируйте репозиторий на машину под управлением AlterOS:
```
git clone github.com/Striker32/Redis-ansible
```
Запустите скрипт ssh-connection-alt.sh, для копирования ключей на машины:
```
chmod +x ./ssh-connection-alt.sh
./ssh-connection-alt.sh
```
После запуска через непродолжительное время вас попросят ввести пароль от root пользователя на одной из машин, затем на следующей и на последней. Вводите пароли в соответствии с теми, в какую машину в данный момент вы копировали скрипт (подсказка: **ИСПОЛЬЗУЙТЕ ГЛАЗА**)
Если копирование ключей прошло успешно, запускайте плейбук ansible в той же директории:
```
ansible-playbook playbook.yml
```
## Завершение
После всех вышеописанных действий вам станет доступен сайт **только** на машине RedOS **только** по домену http://astra.redis/
